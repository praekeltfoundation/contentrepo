{% with folder_data=folder %}
<tr class="folder-row {% if folder_data.subfolders or folder_data.templates %}has-children{% endif %}"
    draggable="true"
    data-folder-id="{{ folder_data.folder.id }}"
    data-depth="{{ folder_data.folder.depth }}">
    <td class="title" data-drop-target="true">
        <div class="folder-title" style="--depth: {{ folder_data.folder.depth }};">
            <span class="icon icon-arrow-down toggle-children"></span>
            <span class="icon icon-folder"></span>
            <a href="{% url 'wagtailsnippets_home_whatsapptemplatefolder:edit' folder_data.folder.id %}">
                {{ folder_data.folder.name }}
            </a>
        </div>
    </td>
    <!-- Type -->
    <td>Folder</td>
    <!-- Category -->
    <td>-</td>
    <!-- Locale -->
    <td>-</td>
    <!-- Status -->
    <td>-</td>
    <!-- Last Modified -->
    <td>{{ folder_data.folder.updated_at|date:"d-M-Y" }}</td>
</tr>

{# Include subfolders #}
{% for subfolder in folder_data.subfolders %}
    {% include "admin/whatsapp_templates/_folder_row.html" with folder=subfolder %}
{% endfor %}

{# Include grouped templates in this folder #}
{% for group in folder_data.templates %}
    {% with template=group.template %}
    <tr class="template-row" 
        draggable="true"
        data-template-id="{{ template.id }}"
        data-folder-id="{{ folder_data.folder.id }}"
        data-depth="{{ folder_data.folder.depth|add:1 }}">
        <td class="title">
            <div style="padding-left: {% widthratio folder_data.folder.depth|add:1 1 20 %}px">
                <a href="{% url 'wagtailsnippets_home_whatsapptemplate:edit' template.id %}">
                    <span class="icon icon-doc-empty"></span>
                    {{ template.slug }}
                </a>
            </div>
        </td>
        <td>Template</td>
        <td>{{ template.get_category_display|default:"-" }}</td>
        <td>{{ group.locales|join:", " }}</td>
        <td>{{ template.get_submission_status_display|default:"-" }}</td>
        <td>{{ template.get_latest_revision.created_at|date:"d-M-Y" }}</td>
    </tr>
    {% endwith %}
{% endfor %}
{% endwith %}